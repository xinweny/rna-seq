library(heatmaply)
heatmaply(z.filt.matrix,
k_row=5,
dist_method="euclidean", hclust_method="complete",
seriate="mean",
colors=palette,
labRow=rownames(z.filt.matrix),
row_dend_left=TRUE,
plot_method="plotly",
custom_hovertext=filt.gene.ids,
file="~/mrc/project/rna-seq/processed/heatmap.html")
browseURL("~/mrc/project/rna-seq/processed/heatmap.html")
filt.prot.table <- prot.table[match(rownames(z.filt.matrix), prot.table$symbol), ]
filt.prot.table[] <- paste("gene_id:", filt.prot.table$gene_id)
heatmaply(z.filt.matrix,
k_row=5,
dist_method="euclidean", hclust_method="complete",
seriate="mean",
colors=palette,
labRow=rownames(z.filt.matrix),
row_dend_left=TRUE,
plot_method="plotly",
custom_hovertext=filt.prot.table,
file="~/mrc/project/rna-seq/processed/heatmap.html")
browseURL("~/mrc/project/rna-seq/processed/heatmap.html")
filt.prot.table[] <- paste("gene_id:", filt.prot.table$gene_id)
filt.prot.table
## Interactive heatmap
library(heatmaply)
# Make interactive heatmap
heatmaply(z.filt.matrix,
k_row=5,
dist_method="euclidean", hclust_method="complete",
seriate="mean",
colors=palette,
labRow=rownames(z.filt.matrix),
row_dend_left=TRUE,
plot_method="plotly",
custom_hovertext=paste("gene_id:", filt.prot.table$gene_id),
file="~/mrc/project/rna-seq/processed/heatmap.html")
browseURL("~/mrc/project/rna-seq/processed/heatmap.html")
head(filt.prot.table)
filt.prot.table <- prot.table[match(rownames(z.filt.matrix), prot.table$symbol), ]
head(filt.prot.table)
head(z.filt.matrix)
## Interactive heatmap
library(heatmaply)
# Make custom hovertext
# Make interactive heatmap
heatmaply(z.filt.matrix,
k_row=5,
dist_method="euclidean", hclust_method="complete",
seriate="mean",
colors=palette,
labRow=rownames(z.filt.matrix),
row_dend_left=TRUE,
plot_method="plotly",
file="~/mrc/project/rna-seq/processed/heatmap.html")
browseURL("~/mrc/project/rna-seq/processed/heatmap.html")
#### Packages ####
library(gplots)
library(RColorBrewer)
library(dplyr)
library(glue)
#### Functions ####
remove_na_dist <- function(mat) {
dist.mat <- as.matrix(dist(mat))
distNAs <- sum(is.na(dist.mat))
if (distNAs > 0) {
giveNAs <- which(is.na(dist.mat),
arr.ind=TRUE)
tab <- sort(table(c(giveNAs)),decreasing=TRUE)
checkNA <- sapply(1:length(tab),function(i){
sum(is.na(as.matrix(dist(mat[-as.numeric(names(tab[1:i])), ]))))})
rmv <- names(tab)[1:min(which(checkNA == 0))]
return(mat[-as.numeric(rmv), ])
} else {
return(mat)
}
}
#### Load data ####
prot.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_foldChange.txt",
sep="\t")
#### Z-scoring ####
# Convert to matrix and z-scoring by gene (rows)
z.matrix <- t(scale(t(data.matrix(prot.table[, 3:ncol(z.table)])),
center=TRUE, scale=TRUE))
# Set gene symbol as matrix row names
rownames(z.matrix) <- prot.table[, 2]
#### Filtering ####
# Remove rows and columns with all NA
z.matrix <- z.matrix[rowSums(is.na(z.matrix)) != ncol(z.matrix),
colSums(is.na(z.matrix)) < nrow(z.matrix)]
# Remove rows giving NA in distance matrix for clustering
z.filt.matrix <- remove_na_dist(z.matrix)
print(glue("Genes remaining: {nrow(z.filt.matrix)} out of {nrow(prot.table)}"))
filt.gene.ids <- prot.table[match(rownames(z.filt.matrix), prot.table$symbol), c("gene_id")]
#### Heatmap ####
# Set up colour palette
palette <- colorRampPalette(c("blue", "white", "red"))(n=299)
# Plot and save static heatmap
heatmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
#### Packages ####
library(gplots)
library(RColorBrewer)
library(dplyr)
library(glue)
#### Functions ####
remove_na_dist <- function(mat) {
dist.mat <- as.matrix(dist(mat))
distNAs <- sum(is.na(dist.mat))
if (distNAs > 0) {
giveNAs <- which(is.na(dist.mat),
arr.ind=TRUE)
tab <- sort(table(c(giveNAs)),decreasing=TRUE)
checkNA <- sapply(1:length(tab),function(i){
sum(is.na(as.matrix(dist(mat[-as.numeric(names(tab[1:i])), ]))))})
rmv <- names(tab)[1:min(which(checkNA == 0))]
return(mat[-as.numeric(rmv), ])
} else {
return(mat)
}
}
#### Load data ####
prot.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_foldChange.txt",
sep="\t")
#### Z-scoring ####
# Convert to matrix and z-scoring by gene (rows)
z.matrix <- t(scale(t(data.matrix(prot.table[, 3:ncol(prot.table)])),
center=TRUE, scale=TRUE))
# Set gene symbol as matrix row names
rownames(z.matrix) <- prot.table[, 2]
#### Filtering ####
# Remove rows and columns with all NA
z.matrix <- z.matrix[rowSums(is.na(z.matrix)) != ncol(z.matrix),
colSums(is.na(z.matrix)) < nrow(z.matrix)]
# Remove rows giving NA in distance matrix for clustering
z.filt.matrix <- remove_na_dist(z.matrix)
print(glue("Genes remaining: {nrow(z.filt.matrix)} out of {nrow(prot.table)}"))
filt.gene.ids <- prot.table[match(rownames(z.filt.matrix), prot.table$symbol), c("gene_id")]
#### Heatmap ####
# Set up colour palette
palette <- colorRampPalette(c("blue", "white", "red"))(n=299)
# Plot and save static heatmap
heatmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
heatmap$colorTable
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
hmap
dev.off()
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
# png("~/mrc/project/rna-seq/processed/heatmap.png",
#     width=3000, height=9000, res=300)
hmap
dev.off()
hmap
dev.off()
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
# png("~/mrc/project/rna-seq/processed/heatmap.png",
#     width=3000, height=9000, res=300)
hmap
dev.off()
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
dev.off()
hmap <- heatmap.2(z.filt.matrix,
main="", # Fold-changes of proteostasis genes in mouse BMDM studies
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
# png("~/mrc/project/rna-seq/processed/heatmap.png",
#     width=3000, height=9000, res=300)
hmap
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
dev.off()
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
graphics.off()
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
graphics.off()
hmap = heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
png(file=NULL, # "~/mrc/project/rna-seq/processed/heatmap.png"
width=3000, height=9000, res=300)
hmap <- heatmap.2(z.filt.matrix,
# main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
hmap
dev.off()
rm(list = ls())
#### Packages ####
library(gplots)
library(RColorBrewer)
library(dplyr)
library(glue)
#### Functions ####
remove_na_dist <- function(mat) {
dist.mat <- as.matrix(dist(mat))
distNAs <- sum(is.na(dist.mat))
if (distNAs > 0) {
giveNAs <- which(is.na(dist.mat),
arr.ind=TRUE)
tab <- sort(table(c(giveNAs)),decreasing=TRUE)
checkNA <- sapply(1:length(tab),function(i){
sum(is.na(as.matrix(dist(mat[-as.numeric(names(tab[1:i])), ]))))})
rmv <- names(tab)[1:min(which(checkNA == 0))]
return(mat[-as.numeric(rmv), ])
} else {
return(mat)
}
}
#### Load data ####
prot.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_foldChange.txt",
sep="\t")
#### Z-scoring ####
# Convert to matrix and z-scoring by gene (rows)
z.matrix <- t(scale(t(data.matrix(prot.table[, 3:ncol(prot.table)])),
center=TRUE, scale=TRUE))
# Set gene symbol as matrix row names
rownames(z.matrix) <- prot.table[, 2]
#### Filtering ####
# Remove rows and columns with all NA
z.matrix <- z.matrix[rowSums(is.na(z.matrix)) != ncol(z.matrix),
colSums(is.na(z.matrix)) < nrow(z.matrix)]
# Remove rows giving NA in distance matrix for clustering
z.filt.matrix <- remove_na_dist(z.matrix)
print(glue("Genes remaining: {nrow(z.filt.matrix)} out of {nrow(prot.table)}"))
filt.gene.ids <- prot.table[match(rownames(z.filt.matrix), prot.table$symbol), c("gene_id")]
#### Heatmap ####
# Set up colour palette
palette <- colorRampPalette(c("blue", "white", "red"))(n=299)
# Plot and save static heatmap
png(file=NULL, # "~/mrc/project/rna-seq/processed/heatmap.png"
width=3000, height=9000, res=300)
hmap <- heatmap.2(z.filt.matrix,
# main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
hmap
dev.off()
png(file="~/mrc/project/rna-seq/processed/heatmap_new.png",
width=3000, height=9000, res=300)
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
hmap
dev.off()
rownames(hmap)
rownames(hmap$rowInd)
rownames(hmap$colorTable)
rownames(hmap$layout)
rownames(hmap$rowDendrogram)
rownames(hmap$carpet)
colnames(hmap$carpet)
padj.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_padj.txt",
sep="\t")
sig.table <- padj.table < 0.05
sig.table
sig.table["Odf1", "GSE82043"]
rownames(sig.table)
colnames(sig.table)
convert_nonsig <- function(hmap, padj.table, alpha) {
sig.table <- padj.table < alpha
rownames(sig.table) <- sig.table$symbol
sig.table$gene_id <- NULL
sig.table$symbol <- NULL
}
rownames(sig.table) <- sig.table$symbol
sig.table$gene_id <- NULL
sig.table$symbol <- NULL
rownames(sig.table)
rownames(padj.table) <- padj.table$symbol
padj.table$gene_id <- NULL
padj.table$symbol <- NULL
sig.table <- padj.table < alpha
rownames(padj.table) <- padj.table$symbol
padj.table$gene_id <- NULL
padj.table$symbol <- NULL
sig.table <- padj.table < 0.05
rownames(sig.table)
sig.table <- padj.table < alpha
alpha <- 0.05
rownames(padj.table) <- padj.table$symbol
padj.table$gene_id <- NULL
padj.table$symbol <- NULL
sig.table <- padj.table < alpha
sig.table
rownames(sig.table)
sig.table <- padj.table < alpha
rownames(sig.table) <- padj.table$symbol
sig.table
colnames(sig.table)
sig.table <- padj.table[, -c(1:2)] < alpha
rownames(sig.table) <- padj.table$symbol
sig.table
padj.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_padj.txt",
sep="\t")
sig.table <- padj.table[, -c(1:2)] < alpha
rownames(sig.table) <- padj.table$symbol
colnames(sig.table)
length(colnames(sig.table))
sig.table["Atic", "GSE110243"]
hmap$carpet["Atic", "GSE110243"]
hmap$carpet["Atic",]
hmap$carpet
rownames(hmap$carpet)
colnames(hmap$carpet)
length(hmap$colorTable)
dim(hmap$colorTable)
hmap$colorTable
hmap$rowInd
hmap$breaks
#### Parameters ####
alpha <- 0.05
#### Load data ####
fc.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_foldChange.txt",
sep="\t")
padj.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_padj.txt",
sep="\t")
#### Z-scoring ####
# Convert to matrix and z-scoring by gene (rows)
z.matrix <- t(scale(t(data.matrix(prot.table[, 3:ncol(fc.table)])),
center=TRUE, scale=TRUE))
# Set gene symbol as matrix row names
rownames(z.matrix) <- prot.table[, 2]
#### Filtering ####
# Convert cells with p < alpha to NA
sig.table <- padj.table[, -c(1:2)] < alpha
rownames(sig.table) <- padj.table$symbol
z.matrix <- ifelse(isFALSE(sig.table), NA, z.matrix)
z.matrix
#### Parameters ####
alpha <- 0.05
#### Load data ####
fc.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_foldChange.txt",
sep="\t")
padj.table <- read.csv("~/mrc/project/rna-seq/data/Inflammation_LPSinWTonly_Mus musculus_macrophage_padj.txt",
sep="\t")
#### Z-scoring ####
# Convert to matrix and z-scoring by gene (rows)
z.matrix <- t(scale(t(data.matrix(fc.table[, 3:ncol(fc.table)])),
center=TRUE, scale=TRUE))
# Set gene symbol as matrix row names
rownames(z.matrix) <- fc.table[, 2]
#### Filtering ####
# Convert cells with p < alpha to NA
sig.table <- padj.table[, -c(1:2)] < alpha
rownames(sig.table) <- padj.table$symbol
z.matrix[sig.table == FALSE, sig.table == FALSE] <- NA
dim(sig.table)
dim(z.matrix)
sig.table == FALSE
z.matrix[which(sig.table == FALSE), which(sig.table == FALSE)] <- NA
which(sig.table == FALSE)
z.matrix[which(sig.table == FALSE)] <- NA
z.matrix
# Remove rows and columns with all NA
z.matrix <- z.matrix[rowSums(is.na(z.matrix)) != ncol(z.matrix),
colSums(is.na(z.matrix)) < nrow(z.matrix)]
# Remove rows giving NA in distance matrix for clustering
z.filt.matrix <- remove_na_dist(z.matrix)
print(glue("Genes remaining: {nrow(z.filt.matrix)} out of {nrow(prot.table)}"))
filt.gene.ids <- fc.table[match(rownames(z.filt.matrix), fc.table$symbol), c("gene_id")]
#### Heatmap ####
# Set up colour palette
palette <- colorRampPalette(c("blue", "white", "red"))(n=299)
# Plot and save static heatmap
png(file="~/mrc/project/rna-seq/processed/heatmap_new.png",
width=3000, height=9000, res=300)
hmap <- heatmap.2(z.filt.matrix,
main="Fold-changes of proteostasis genes in mouse BMDM studies",
Rowv=TRUE, Colv=TRUE,
srtCol=45,
labRow=FALSE,
notecol="black",
density.info="none",
trace="none",
col=palette,
na.color="black",
key=TRUE, keysize=1, lhei=c(1, 15), key.xlab="z-score")
hmap
dev.off()
hmap
dim(hmap$carpet)
dim(hmap$color)
dim(hmap$col)
hmap$carpet
